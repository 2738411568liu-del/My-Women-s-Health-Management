<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å¥³æ€§å¥åº·ç®¡ç†ç³»ç»Ÿ - Firebase ç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7fb;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      background: #4b7bec;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #3867d6;
    }
    h2 { margin-bottom: 5px; }
    .record {
      padding: 10px;
      background: #eef3ff;
      border-radius: 8px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>å¥³æ€§å¥åº·ç®¡ç†ï¼ˆFirebase æ•°æ®åº“ç‰ˆï¼‰</h2>
    <p>åŒ¿åç™»å½•å·²è‡ªåŠ¨å¯ç”¨ï¼Œæ•°æ®å°†å­˜å…¥ Firebase Realtime Databaseã€‚</p>

    <hr>

    <h3>ğŸ“… è®°å½•æ¯æ—¥å¥åº·çŠ¶æ€</h3>

    <label>ç”Ÿç†æœŸå¼€å§‹æ—¥æœŸï¼ˆ1-31ï¼‰</label>
    <input type="number" id="periodStart" min="0" max="31" placeholder="ä¾‹å¦‚ï¼š5ï¼ˆæ— è¯·è¾“å…¥0ï¼‰">

    <label>ç”Ÿç†æœŸç»“æŸæ—¥æœŸï¼ˆ1-31ï¼‰</label>
    <input type="number" id="periodEnd" min="0" max="31" placeholder="ä¾‹å¦‚ï¼š10ï¼ˆæ— è¯·è¾“å…¥0ï¼‰">

    <label>èº«ä½“çŠ¶æ€ï¼ˆ1-5ï¼‰</label>
    <input type="number" id="bodyCondition" min="1" max="5" value="3">

    <label>æƒ…ç»ªçŠ¶æ€ï¼ˆ1-5ï¼‰</label>
    <input type="number" id="emotionState" min="1" max="5" value="3">

    <button onclick="saveRecord()">ä¿å­˜è®°å½•</button>

    <hr>

    <h3>ğŸ“Š å†å²è®°å½•</h3>
    <div id="records"></div>
  </div>

  <script>
    // ===============================
    // Firebase é…ç½®ï¼ˆå·²ä½¿ç”¨ä½ æä¾›çš„é…ç½®ï¼‰
    // ===============================
    const firebaseConfig = {
      apiKey: "AIzaSyA8m1mFT8lwW553kB3pJmVv8ViMEBYSrDM",
      authDomain: "my-women-s-health-management.firebaseapp.com",
      databaseURL: "https://my-women-s-health-management-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "my-women-s-health-management",
      storageBucket: "my-women-s-health-management.firebasestorage.app",
      messagingSenderId: "281305293774",
      appId: "1:281305293774:web:7f3345d120d1b2d5c8819f",
      measurementId: "G-E2T3SZ6CX9"
    };

    // åˆå§‹åŒ– Firebase
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();

    let currentUser = null;

    // è‡ªåŠ¨åŒ¿åç™»å½•
    auth.signInAnonymously()
      .then(() => {
        console.log("åŒ¿åç™»å½•æˆåŠŸ");
        auth.onAuthStateChanged(user => {
          currentUser = user;
          loadRecords();
        });
      })
      .catch(err => console.error(err));


    // ==========================
    // ä¿å­˜è®°å½•åˆ° Firebase
    // ==========================
    function saveRecord() {
      if (!currentUser) return alert("ç”¨æˆ·æœªç™»å½•");

      const uid = currentUser.uid;
      const today = new Date().toISOString().split('T')[0];

      const data = {
        date: today,
        periodStart: Number(document.getElementById("periodStart").value),
        periodEnd: Number(document.getElementById("periodEnd").value),
        bodyCondition: Number(document.getElementById("bodyCondition").value),
        emotionState: Number(document.getElementById("emotionState").value),
        timestamp: Date.now()
      };

      db.ref("health_records/" + uid + "/" + today).set(data)
        .then(() => {
          alert("è®°å½•ä¿å­˜æˆåŠŸï¼");
          loadRecords();
        })
        .catch(err => alert("ä¿å­˜å¤±è´¥ï¼š" + err));
    }

    // ==========================
    // åŠ è½½å†å²è®°å½•
    // ==========================
    function loadRecords() {
      if (!currentUser) return;

      const uid = currentUser.uid;
      const listDiv = document.getElementById("records");
      listDiv.innerHTML = "åŠ è½½ä¸­...";

      db.ref("health_records/" + uid)
        .orderByChild("timestamp")
        .limitToLast(30)
        .once("value", snapshot => {
          listDiv.innerHTML = "";
          snapshot.forEach(child => {
            const r = child.val();
            listDiv.innerHTML += `
              <div class="record">
                <b>${r.date}</b><br>
                ç”Ÿç†æœŸï¼š${r.periodStart} - ${r.periodEnd}<br>
                èº«ä½“çŠ¶æ€ï¼š${r.bodyCondition}<br>
                æƒ…ç»ªçŠ¶æ€ï¼š${r.emotionState}
              </div>
            `;
          });
        });
    }
  </script>

</body>
</html>
